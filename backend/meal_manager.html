<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Meal Manager</title>
    <link rel="icon" type="image/svg+xml" href="../assets/images/logo.svg" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="../assets/fontawesome-free-6.7.2-web/css/all.min.css"
    />
    <link rel="stylesheet" href="../assets/css/style-admin.css" />
    <link href="../assets/css/reset.css" rel="stylesheet" />
    <link rel="stylesheet" href="" />
    <link
      href="https://cdn.quilljs.com/1.3.6/quill.snow.css"
      rel="stylesheet"
    />
    <style>
      body {
        background: #f8f9fa;
      }

      .modal-lg {
        max-width: 800px;
      }

      .hashtag-container {
        background-color: #ffffff;
        border-radius: 8px; /* Bo tròn góc vừa phải hơn */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Bóng nhẹ, giống elevation 2 */
        padding: 30px;
        width: 100%;
        text-align: center;
      }

      h2 {
        color: #333;
        margin-bottom: 25px;
        font-size: 1.8em;
        font-weight: 500; /* Độ đậm vừa phải */
      }

      .hashtag-input-wrapper {
        border: 1px solid #e0e0e0; /* Viền nhẹ */
        border-radius: 6px; /* Bo tròn góc */
        padding: 10px 15px;
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        min-height: 55px; /* Chiều cao tối thiểu */
        gap: 8px; /* Khoảng cách giữa các chip */
        background-color: #ffffff;
        transition: border-color 0.3s ease, box-shadow 0.3s ease;
      }

      .hashtag-input-wrapper:focus-within {
        border-color: #1976d2; /* Màu xanh dương chủ đạo của Vuetify */
        box-shadow: 0 0 0 2px rgba(25, 118, 210, 0.2); /* Shadow xanh dương khi focus */
      }

      #hashtagInput {
        flex-grow: 1;
        border: none;
        outline: none;
        padding: 6px 0;
        font-size: 1em;
        min-width: 100px;
        color: #424242;
      }

      #hashtagInput::placeholder {
        color: #9e9e9e; /* Màu placeholder nhẹ nhàng */
      }

      .hashtag-list {
        list-style: none;
        padding: 0;
        margin: 0;
        display: flex;
        flex-wrap: wrap;
        gap: 8px; /* Khoảng cách giữa các chip */
        align-items: center;
      }

      /* --- Phần chỉnh sửa để giống Vuetify Chip --- */
      .hashtag-item {
        background-color: #e0e0e0; /* Màu xám nhạt, giống default chip */
        color: #424242; /* Màu chữ đậm */
        border-radius: 16px; /* Bo tròn góc nhiều hơn một chút (để giống 16px của Vuetify) */
        padding: 4px 12px; /* Padding nhỏ gọn */
        display: flex;
        align-items: center;
        gap: 4px; /* Khoảng cách giữa chữ và nút 'x' */
        font-size: 0.875em; /* Kích thước font điển hình của Vuetify chip */
        font-weight: 500; /* Độ đậm vừa phải */
        white-space: nowrap;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.15); /* Bóng đổ nhẹ, giống elevation 1 */
        transition: background-color 0.2s ease, box-shadow 0.2s ease,
          color 0.2s ease;
      }

      .hashtag-item:hover {
        background-color: #d6d6d6; /* Hơi đậm hơn khi hover */
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); /* Bóng rõ hơn khi hover, giống elevation 2 */
        cursor: default; /* Không phải pointer vì nút 'x' đã là riêng */
      }

      .hashtag-item .remove-tag {
        /* Các thuộc tính để nút 'x' giống icon close của Vuetify */
        background: none; /* Không có nền */
        border: none; /* Không viền */
        color: #616161; /* Màu icon xám */
        cursor: pointer;
        font-size: 1.1em; /* Kích thước icon */
        width: 20px; /* Đảm bảo kích thước cố định */
        height: 20px;
        border-radius: 50%; /* Hình tròn */
        display: flex;
        justify-content: center;
        align-items: center;
        margin-left: 4px; /* Khoảng cách với chữ */
        transition: background-color 0.2s ease, color 0.2s ease;
      }

      .hashtag-item .remove-tag:hover {
        background-color: #bdbdbd; /* Nền xám khi hover */
        color: #212121; /* Icon đen hơn khi hover */
      }


      .instruction {
        font-size: 0.8em; /* Kích thước nhỏ hơn */
        color: #757575; /* Màu xám đậm hơn */
        margin-top: 20px;
      }
    </style>
  </head>

  <body>
    <div class="container-fluid">
      <div class="row">
        <!-- sidebar -->
        <nav
          id="sidebar"
          class="col-md-3 col-lg-2 d-md-block bg-dark sidebar collapse"
        >
          <div class="position-sticky pt-3">
            <div
              class="logo-admin text-center pt-3 d-flex align-items-center justify-content-center"
            >
              <a href="#">
                <i class="fas fa-seedling"></i>
                <span>NutriPlanner</span>
              </a>
            </div>
            <ul class="nav flex-column">
              <li class="nav-item">
                <a href="./admin.php" class="nav-link text-white tab-btn">
                  <i class="fa fa-tachometer-alt me-2"></i> Dashboard
                </a>
              </li>
              <li class="nav-item">
                <a
                  href="./meal_manager.html"
                  class="nav-link active text-white tab-btn"
                >
                  <i class="fa fa-utensils me-2"></i> Meal manager
                </a>
              </li>
              <li class="nav-item">
                <a
                  href="./material_manager.html"
                  class="nav-link text-white tab-btn"
                >
                  <i class="fa fa-tags me-2"></i> Material management
                </a>
              </li>
              <li class="nav-item">
                <a
                  href="./user_manager.html"
                  class="nav-link text-white tab-btn"
                >
                  <i class="fa fa-users me-2"></i> User management
                </a>
              </li>
              <li class="nav-item">
                <a
                  href="./feedback_manager.html"
                  class="nav-link text-white tab-btn"
                >
                  <i class="fa fa-comments me-2"></i> Feedback
                </a>
              </li>
            </ul>
          </div>
        </nav>
        <!-- main content -->
        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
          <div
            class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom"
          >
            <h1 class="h2 fw-bold">Meal Manager</h1>
            <div class="btn-toolbar mb-2 mb-md-0">
              <div class="dropdown">
                <button
                  class="btn btn-sm btn-outline-none dropdown-toggle"
                  data-bs-toggle="dropdown"
                  type="button"
                >
                  <img
                    src="../assets/images/admin.jpg"
                    alt="admin"
                    class="rounded-circle"
                    width="30"
                  />
                  <span class="text-login">Admin</span>
                </button>
                <ul class="dropdown-menu">
                  <li>
                    <a class="dropdown-item" href="profile.html">Hồ sơ</a>
                  </li>
                  <li>
                    <a class="dropdown-item" href="login.html">Đăng xuất</a>
                  </li>
                </ul>
              </div>
            </div>
          </div>
          <div class="container-fluid py-4">
            <div class="card mb-4">
              <div class="card-body">
                <form id="searchForm">
                  <div class="row g-3">
                    <div class="col-md-3">
                      <label class="form-label">Tên món ăn</label>
                      <input
                        type="text"
                        class="form-control"
                        name="search_name"
                        placeholder="Nhập tên món ăn..."
                      />
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">Loại bữa ăn</label>
                      <select class="form-select" name="search_type">
                        <option value="">Tất cả</option>
                        <option value="1">Bữa sáng</option>
                        <option value="2">Bữa trưa</option>
                        <option value="3">Bữa tối</option>
                        <option value="4">Ăn vặt</option>
                      </select>
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">Chế độ ăn</label>
                      <select class="form-select" name="search_tag">
                        <option value="">Tất cả</option>
                        <option value="1">Vegan</option>
                        <option value="2">Vegetarian</option>
                        <option value="3">Keto</option>
                        <option value="4">Paleo</option>
                        <option value="5">Low Carb</option>
                        <option value="6">High Protein</option>
                      </select>
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">Trạng thái</label>
                      <select class="form-select" name="search_status">
                        <option value="">Tất cả</option>
                        <option value="visible">Hiển thị</option>
                        <option value="hidden">Ẩn</option>
                      </select>
                    </div>
                    <div class="col-12">
                      <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-primary">
                          <i class="fas fa-search me-2"></i>Tìm kiếm
                        </button>
                        <button type="reset" class="btn btn-light border">
                          <i class="fas fa-redo me-2"></i>Đặt lại
                        </button>
                      </div>
                    </div>
                  </div>
                </form>
              </div>
            </div>

            <div class="d-flex justify-content-between align-items-center mb-4">
              <button
                class="btn btn-success add-meal-btn"
                data-bs-toggle="modal"
                data-bs-target="#mealModal"
              >
                <i class="fa fa-plus"></i> Thêm bữa ăn
              </button>
            </div>
            <div class="card">
              <div class="card-body">
                <div class="table-responsive">
                  <table class="table table-striped align-middle">
                    <thead class="table-light">
                      <tr>
                        <th>ID</th>
                        <th>Tên Bữa Ăn</th>
                        <th>Danh Mục</th>
                        <th>Calo</th>
                        <th>Tags</th>
                        <th>Ngày Tạo</th>
                        <th>Trạng Thái</th>
                        <th class="text-center">Thao Tác</th>
                      </tr>
                    </thead>
                    <tbody id="body_listmeals">
                      <tr>
                        <td>1</td>
                        <td>Salad Cá Hồi</td>
                        <td>Bữa Trưa</td>
                        <td>450</td>
                        <td>Keto, High Protein</td>
                        <td>01/06/2024</td>
                        <td><span class="badge bg-success">Hiển thị</span></td>
                        <td class="text-center">
                          <button class="btn btn-sm btn-primary">
                            <i class="fa-solid fa-pencil"></i>
                          </button>
                          <button class="btn btn-sm btn-danger">
                            <i class="fa-solid fa-trash"></i>
                          </button>
                        </td>
                      </tr>
                      <tr>
                        <td>2</td>
                        <td>Cháo Yến Mạch</td>
                        <td>Bữa Sáng</td>
                        <td>320</td>
                        <td>Vegan</td>
                        <td>02/06/2024</td>
                        <td><span class="badge bg-secondary">Ẩn</span></td>
                        <td class="text-center">
                          <button class="btn btn-sm btn-primary">
                            <i class="fa-solid fa-pencil"></i>
                          </button>
                          <button class="btn btn-sm btn-danger">
                            <i class="fa-solid fa-trash"></i>
                          </button>
                        </td>
                      </tr>
                      <!-- Thêm dòng mẫu khác nếu muốn -->
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
          <!-- Modal Thêm/Sửa Bữa Ăn -->
          <div
            class="modal fade"
            id="mealModal"
            tabindex="-1"
            aria-labelledby="mealModalLabel"
            aria-hidden="true"
          >
            <div class="modal-dialog modal-lg">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title fw-bold" id="mealModalLabel">
                    Thêm Bữa Ăn Mới
                  </h5>
                  <button
                    type="button"
                    class="btn-close"
                    data-bs-dismiss="modal"
                    aria-label="Close"
                  ></button>
                </div>
                <div class="modal-body">
                  <form id="mealForm" >
                    <!-- Thông tin cơ bản -->
                    <div class="card mb-3">
                      <div class="card-header bg-light">
                        <h6 class="mb-0">Thông tin cơ bản</h6>
                      </div>
                      <div class="card-body">
                        <div class="row g-2">
                          <div class="col-md-6">
                            <label class="form-label">Tên món ăn</label>
                            <input required name="name" class="form-control" />
                          </div>
                          <div class="col-md-3">
                            <label class="form-label"
                              >Thời gian nấu (phút)</label
                            >
                            <input
                              name="prep_time"
                              type="number"
                              class="form-control"
                            />
                          </div>
                          <div class="col-md-3">
                            <label class="form-label">Calories</label>
                            <input
                              name="calories"
                              type="number"
                              class="form-control"
                              required
                            />
                          </div>
                        </div>
                      </div>
                    </div>

                    <!-- Phân loại món ăn -->
                    <div class="card mb-3">
                      <div class="card-header bg-light">
                        <h6 class="mb-0">Phân loại</h6>
                      </div>
                      <div class="card-body">
                        <div class="row g-2">
                          <div class="col-md-12">
                            <label class="form-label">Loại bữa ăn</label>
                            <div class="d-flex gap-3">
                              <div class="form-check">
                                <input
                                  class="form-check-input"
                                  type="checkbox"
                                  name="meal_types"
                                  value="Breakfast"
                                  id="type_breakfast"
                                />
                                <label
                                  class="form-check-label"
                                  for="type_breakfast"
                                  >Breakfast</label
                                >
                              </div>
                              <div class="form-check">
                                <input
                                  class="form-check-input"
                                  type="checkbox"
                                  name="meal_types"
                                  value="Lunch"
                                  id="type_lunch"
                                />
                                <label class="form-check-label" for="type_lunch"
                                  >Lunch</label
                                >
                              </div>
                              <div class="form-check">
                                <input
                                  class="form-check-input"
                                  type="checkbox"
                                  name="meal_types"
                                  value="Dinner"
                                  id="type_dinner"
                                />
                                <label
                                  class="form-check-label"
                                  for="type_dinner"
                                  >Dinner</label
                                >
                              </div>
                              <div class="form-check">
                                <input
                                  class="form-check-input"
                                  type="checkbox"
                                  name="meal_types"
                                  value="Snacks"
                                  id="type_snack"
                                />
                                <label class="form-check-label" for="type_snack"
                                  >Snacks</label
                                >
                              </div>
                              <div class="form-check">
                                <input
                                  class="form-check-input"
                                  type="checkbox"
                                  name="meal_types"
                                  value="Smoothíe"
                                  id="type_snack"
                                />
                                <label class="form-check-label" for="type_snack"
                                  >Smoothies</label
                                >
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <!-- Thông tin dinh dưỡng -->
                    <div class="card mb-3">
                      <div class="card-header bg-light">
                        <h6 class="mb-0">Thông tin dinh dưỡng</h6>
                      </div>
                      <div class="card-body">
                        <div class="row g-3">
                          <div class="col-md-4">
                            <label class="form-label">Protein</label>
                            <div class="input-group">
                              <input
                                name="protein"
                                type="number"
                                class="form-control"
                              />
                              <span class="input-group-text">g</span>
                            </div>
                          </div>
                          <div class="col-md-4">
                            <label class="form-label">Carbs</label>
                            <div class="input-group">
                              <input
                                name="carbs"
                                type="number"
                                class="form-control"
                              />
                              <span class="input-group-text">g</span>
                            </div>
                          </div>
                          <div class="col-md-4">
                            <label class="form-label">Chất béo</label>
                            <div class="input-group">
                              <input
                                name="fats"
                                type="number"
                                class="form-control"
                              />
                              <span class="input-group-text">g</span>
                            </div>
                          </div>
                          <div class="col-md-4">
                            <label class="form-label">Chất xơ</label>
                            <div class="input-group">
                              <input
                                name="fiber"
                                type="number"
                                class="form-control"
                              />
                              <span class="input-group-text">g</span>
                            </div>
                          </div>
                          <div class="col-md-4">
                            <label class="form-label">Đường</label>
                            <div class="input-group">
                              <input
                                name="sugar"
                                type="number"
                                class="form-control"
                              />
                              <span class="input-group-text">g</span>
                            </div>
                          </div>
                          <div class="col-md-4">
                            <label class="form-label">Natri</label>
                            <div class="input-group">
                              <input
                                name="sodium"
                                type="number"
                                class="form-control"
                              />
                              <span class="input-group-text">mg</span>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <!-- Tags và chế độ ăn -->
                    <div class="card mb-3">
                      <nav class="card-header bg-light">
                        <div class="nav nav-tabs" id="nav-tab" role="tablist">
                          <button
                            class="nav-link active"
                            id="nav-description-tab"
                            data-bs-toggle="tab"
                            data-bs-target="#nav-description"
                            type="button"
                            role="tab"
                            aria-controls="nav-description"
                            aria-selected="true"
                          >
                            Description
                          </button>
                          <button
                            class="nav-link"
                            id="nav-ingredients-tab"
                            data-bs-toggle="tab"
                            data-bs-target="#nav-ingredients"
                            type="button"
                            role="tab"
                            aria-controls="nav-ingredients"
                            aria-selected="false"
                          >
                            Ingredients
                          </button>
                          <button
                            class="nav-link"
                            id="nav-instruction-tab"
                            data-bs-toggle="tab"
                            data-bs-target="#nav-instruction"
                            type="button"
                            role="tab"
                            aria-controls="nav-instruction"
                            aria-selected="false"
                          >
                            Instruction
                          </button>
                        </div>
                      </nav>
                      <div class="tab-content card-body" id="nav-tabContent">
                        <div
                          class="tab-pane fade show active"
                          id="nav-description"
                          role="tabpanel"
                          aria-labelledby="nav-description-tab"
                        >
                          <div
                            id="editor__description"
                            style="height: 200px"
                          ></div>
                          <input
                            type="hidden"
                            name="description"
                            id="description"
                          />
                        </div>

                        <div
                          class="tab-pane fade"
                          id="nav-ingredients"
                          role="tabpanel"
                          aria-labelledby="nav-profile-tab"
                        >
                          <div
                            id="editor__ingredients"
                            style="height: 200px"
                          ></div>
                          <input
                            type="hidden"
                            name="ingredients"
                            id="ingredients"
                          />
                        </div>
                        <div
                          class="tab-pane fade"
                          id="nav-instruction"
                          role="tabpanel"
                          aria-labelledby="nav-instruction-tab"
                        >
                          <div
                            id="editor__instruction"
                            style="height: 200px"
                          ></div>
                          <input
                            type="hidden"
                            name="instruction"
                            id="instruction"
                          />
                        </div>
                      </div>
                    </div>
                    <div class="card mb-3">
                      <div class="card-header bg-light">
                        <h6>Thêm Hashtag cho Món Ăn</h6>
                      </div>

                      <div class="hashtag-container card-body py-0 my-3">
                        <p class="instruction m-0 py-3">
                          Mẹo: Gõ hashtag, nhấn Enter hoặc dấu phẩy để thêm.
                          Nhấn 'x' để xóa.
                        </p>
                        <div class="hashtag-input-wrapper">
                          <input
                            type="text"
                            id="hashtagInput"
                            placeholder="Nhập hashtag và nhấn Enter hoặc dấu phẩy (,)"
                          />

                        </div>
                        <div class="py-3">
                          <ul id="hashtagList" class="hashtag-list"></ul>
                        </div>
                      </div>
                    </div>

                    <!-- Hình ảnh và trạng thái -->
                    <div class="card mb-3">
                      <div class="card-header bg-light">
                        <h6 class="mb-0">Hình ảnh và trạng thái</h6>
                      </div>
                      <div class="card-body">
                        <div class="row g-3">
                          <div class="col-md-6">
                            <label class="form-label">Hình ảnh món ăn</label>
                            <input
                              name="image"
                              type="file"
                              class="form-control"
                              accept="image/*"
                            />
                          </div>
                          <div class="col-md-6">
                            <label class="form-label">Trạng thái</label>
                            <select name="status" class="form-select">
                              <option value="visible">Hiển thị</option>
                              <option value="hidden">Ẩn</option>
                            </select>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="d-flex justify-content-end gap-2 mt-3">
                      <button
                        type="button"
                        class="btn btn-light border"
                        data-bs-dismiss="modal"
                      >
                        Hủy
                      </button>
                      <button type="submit" class="btn btn-primary px-4">
                        Lưu món ăn
                      </button>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
    <script>
      let hashtags = []; // Mảng để lưu trữ các hashtagX
      document.addEventListener("DOMContentLoaded", () => {
        const hashtagInput = document.getElementById("hashtagInput");
        const hashtagList = document.getElementById("hashtagList");
        
        const renderHashtags = () => {
          hashtagList.innerHTML = "";
          hashtags.forEach((tag, index) => {
            const li = document.createElement("li");
            li.className = "hashtag-item";

            const span = document.createElement("span");
            span.className = "value__tag"; // 👈 Thêm class vào đây
            span.textContent = tag; // An toàn

            const button = document.createElement("button");
            button.type = "button";
            button.className = "remove-tag";
            button.dataset.index = index;
            button.textContent = "x";

            li.appendChild(span);
            li.appendChild(button);
            hashtagList.appendChild(li);
          });
        };

        // Hàm để thêm một hashtag
        const addHashtag = (tag) => {
          const cleanedTag = tag.trim().toLowerCase(); // Xóa khoảng trắng và chuyển về chữ thường
          if (cleanedTag && !hashtags.includes(cleanedTag)) {
            // Chỉ thêm nếu không rỗng và chưa tồn tại
            hashtags.push(cleanedTag);
            renderHashtags();
          }
        };

        // Hàm để xóa một hashtag
        const removeHashtag = (index) => {
          hashtags.splice(index, 1); // Xóa phần tử tại vị trí index
          renderHashtags();
        };

        // Lắng nghe sự kiện bàn phím trên trường input
        hashtagInput.addEventListener("keydown", (e) => {
          if (e.key === "Enter" || e.key === ",") {
            // Thêm hashtag khi nhấn Enter hoặc dấu phẩy
            e.preventDefault(); // Ngăn chặn hành vi mặc định (ví dụ: tạo dòng mới)
            const inputValue = hashtagInput.value;
            if (inputValue) {
              addHashtag(inputValue);
              hashtagInput.value = ""; // Xóa nội dung trong input sau khi thêm
            }
          }
        });

        // Lắng nghe sự kiện click trên các nút 'x' (xóa hashtag)
        hashtagList.addEventListener("click", (e) => {
          if (e.target.classList.contains("remove-tag")) {
            const index = parseInt(e.target.dataset.index); // Lấy index từ data-index
            removeHashtag(index);
          }
        });

        // (Tùy chọn) Xử lý dán văn bản có nhiều hashtag
        hashtagInput.addEventListener("paste", (e) => {
          e.preventDefault();
          const pasteData = e.clipboardData.getData("text");
          const tags = pasteData
            .split(/[\s,]+/)
            .filter((tag) => tag.trim() !== ""); // Tách theo khoảng trắng hoặc dấu phẩy
          tags.forEach((tag) => addHashtag(tag));
          hashtagInput.value = "";
        });

        // (Tùy chọn) Khởi tạo với một vài hashtag demo
      });


    </script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const tabbutton = document.querySelectorAll(".tab-btn");

        tabbutton.forEach((button) => {
          button.addEventListener("click", () => {
            tabbutton.forEach((btn) => btn.classList.remove("active"));
            button.classList.add("active");
          });
        });

        const searchForm = document.getElementById("searchForm");
        const tableBody = document.querySelector("table tbody");

        // Xử lý sự kiện submit form tìm kiếm
        searchForm.addEventListener("submit", async (e) => {
          e.preventDefault();

          // Lấy giá trị từ form
          const formData = new FormData(searchForm);
          const searchParams = new URLSearchParams();

          // Chuyển đổi FormData thành URLSearchParams
          formData.forEach((value, key) => {
            if (value) searchParams.append(key, value);
          });

          try {
            // Gọi API tìm kiếm
            const response = await fetch(
              `search.php?${searchParams.toString()}`
            );
            const result = await response.json();

            if (result.status === "success") {
              // Xóa dữ liệu cũ trong bảng
              tableBody.innerHTML = "";

              // Hiển thị kết quả mới
              result.data.forEach((meal) => {
                const row = document.createElement("tr");
                row.innerHTML = `
                                <td>${meal.id}</td>
                                <td>${meal.name}</td>
                                <td>${meal.meal_types.join(", ")}</td>
                                <td>${meal.calories}</td>
                                <td>${meal.diet_tags.join(", ")}</td>
                                <td>${meal.created_at}</td>
                                <td><span class="badge bg-${
                                  meal.status === "visible"
                                    ? "success"
                                    : "secondary"
                                }">${meal.status}</span></td>
                                <td class="text-center">
                                    <button class="btn btn-sm btn-primary" onclick="editMeal(${
                                      meal.id
                                    })">
                                        <i class="fa-solid fa-pencil"></i>
                                    </button>
                                    <button class="btn btn-sm btn-danger" onclick="deleteMeal(${
                                      meal.id
                                    })">
                                        <i class="fa-solid fa-trash"></i>
                                    </button>
                                </td>
                            `;
                tableBody.appendChild(row);
              });
            } else {
              alert("Có lỗi xảy ra khi tìm kiếm");
            }
          } catch (error) {
            console.error("Error:", error);
            alert("Không thể kết nối đến server");
          }
        });

        // Xử lý nút reset
        searchForm.addEventListener("reset", () => {
          setTimeout(() => searchForm.dispatchEvent(new Event("submit")), 10);
        });
      });

      // Các hàm xử lý khác
      function editMeal(id) {
        // TODO: Implement edit functionality
        console.log("Edit meal:", id);
      }

      function deleteMeal(id) {
        console.log("Delete meal:", id);
        meals = meals.filter((meal) => meal.id !== id);
        console.log(meals);
        render(meals);
        fetch("admin.php", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            id: id,
          }),
        });
      }
    </script>
    <script>
      let meals = [];

      async function listmeals() {
        let res = await fetch("../meals.json");
        const data = await res.json();
        meals = data;
        render(meals);
      }
      listmeals();
      const render = (meals) => {
        document.getElementById("body_listmeals").innerHTML = "";
        meals.forEach((meal) => {
          let tagHtml = "";
          meal.tags.forEach((tag) => {
            tagHtml += `<button class="btn btn-success mx-1 p-1">${tag}</button>`;
          });

          let element = document.createElement("tr");
          element.innerHTML = `
                                    <td>${meal.id}</td>
                                    <td>${meal.name}</td>
                                    <td>${meal.type}</td>
                                    <td>${meal.calories}</td>
                                    <td>${tagHtml}</td>
                                    <td>${meal.create_at}</td>
                                    <td><span class="badge bg-${
                                      meal.status === "visible"
                                        ? "success"
                                        : "secondary"
                                    }">${meal.status}</span></td>
                                    <td class="text-center">
                                        <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#mealModal" onclick="editMeal(${
                                          meal.id
                                        })">
                                            <i class="fa-solid fa-pencil"></i>
                                        </button>
                                        <button class="btn btn-sm btn-danger" onclick="deleteMeal(${
                                          meal.id
                                        })">
                                            <i class="fa-solid fa-trash"></i>
                                        </button>
                                    </td>
                                `;
          document.getElementById("body_listmeals").appendChild(element);
        });
      };

      const quill = new Quill("#editor__description", { theme: "snow" });
      const quill2 = new Quill("#editor__ingredients", { theme: "snow" });
      const quill3 = new Quill("#editor__instruction", { theme: "snow" });
      //xử lý form
      document
        .getElementById("mealForm")
        .addEventListener("submit", function (e) {
          e.preventDefault(); // Ngăn form reload trang

          document.getElementById("description").value = quill.root.innerHTML;
          document.getElementById("ingredients").value = quill2.root.innerHTML;
          document.getElementById("instruction").value = quill3.root.innerHTML;
          const formData = new FormData(this);
          formData.append('hashtags',hashtags.join(","));

          fetch(" upload.php", {
            method: "POST",
            body: formData,
          })
            .then(async (res) => {
              const text = await res.text(); // lấy nguyên nội dung trả về
              console.log("Raw response:", text);
              try {
                const data = JSON.parse(text);
                if (data.status === "success") {
                  alert("Upload thành công! Đường dẫn: " + data.path);
                } else {
                  alert("Upload thất bại!");
                }
              } catch (e) {
                console.error("Không thể parse JSON:", e);
              }
            })
            .catch((err) => {
              console.error("Lỗi fetch:", err);
            });
        });
    </script>
  </body>
</html>
